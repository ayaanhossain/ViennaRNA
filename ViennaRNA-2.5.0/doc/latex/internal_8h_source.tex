\hypertarget{internal_8h_source}{}\doxysection{internal.\+h}
\label{internal_8h_source}\index{ViennaRNA/loops/internal.h@{ViennaRNA/loops/internal.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001 \textcolor{preprocessor}{\#ifndef VIENNA\_RNA\_PACKAGE\_LOOPS\_INTERNAL\_H}}
\DoxyCodeLine{00002 \textcolor{preprocessor}{\#define VIENNA\_RNA\_PACKAGE\_LOOPS\_INTERNAL\_H}}
\DoxyCodeLine{00003 }
\DoxyCodeLine{00004 \textcolor{preprocessor}{\#include <math.h>}}
\DoxyCodeLine{00005 }
\DoxyCodeLine{00006 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{utils_2basic_8h}{ViennaRNA/utils/basic.h}}>}}
\DoxyCodeLine{00007 \textcolor{preprocessor}{\#include <ViennaRNA/params/default.h>}}
\DoxyCodeLine{00008 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{datastructures_2basic_8h}{ViennaRNA/datastructures/basic.h}}>}}
\DoxyCodeLine{00009 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{fold__compound_8h}{ViennaRNA/fold\_compound.h}}>}}
\DoxyCodeLine{00010 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{params_2basic_8h}{ViennaRNA/params/basic.h}}>}}
\DoxyCodeLine{00011 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{hard_8h}{ViennaRNA/constraints/hard.h}}>}}
\DoxyCodeLine{00012 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{soft_8h}{ViennaRNA/constraints/soft.h}}>}}
\DoxyCodeLine{00013 }
\DoxyCodeLine{00014 \textcolor{preprocessor}{\#ifdef VRNA\_WARN\_DEPRECATED}}
\DoxyCodeLine{00015 \textcolor{preprocessor}{\# if defined(DEPRECATED)}}
\DoxyCodeLine{00016 \textcolor{preprocessor}{\#   undef DEPRECATED}}
\DoxyCodeLine{00017 \textcolor{preprocessor}{\# endif}}
\DoxyCodeLine{00018 \textcolor{preprocessor}{\# if defined(\_\_clang\_\_)}}
\DoxyCodeLine{00019 \textcolor{preprocessor}{\#  define DEPRECATED(func, msg) func \_\_attribute\_\_ ((deprecated("{}"{}}, msg)))}
\DoxyCodeLine{00020 \textcolor{preprocessor}{\# elif defined(\_\_GNUC\_\_)}}
\DoxyCodeLine{00021 \textcolor{preprocessor}{\#  define DEPRECATED(func, msg) func \_\_attribute\_\_ ((deprecated(msg)))}}
\DoxyCodeLine{00022 \textcolor{preprocessor}{\# else}}
\DoxyCodeLine{00023 \textcolor{preprocessor}{\#  define DEPRECATED(func, msg) func}}
\DoxyCodeLine{00024 \textcolor{preprocessor}{\# endif}}
\DoxyCodeLine{00025 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00026 \textcolor{preprocessor}{\# define DEPRECATED(func, msg) func}}
\DoxyCodeLine{00027 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00028 }
\DoxyCodeLine{00029 \textcolor{preprocessor}{\#ifdef \_\_GNUC\_\_}}
\DoxyCodeLine{00030 \textcolor{preprocessor}{\# define INLINE inline}}
\DoxyCodeLine{00031 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00032 \textcolor{preprocessor}{\# define INLINE}}
\DoxyCodeLine{00033 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00034 }
\DoxyCodeLine{00052 \textcolor{keywordtype}{int}}
\DoxyCodeLine{00053 vrna\_E\_int\_loop(\mbox{\hyperlink{group__fold__compound_structvrna__fc__s}{vrna\_fold\_compound\_t}}  *fc,}
\DoxyCodeLine{00054                 \textcolor{keywordtype}{int}                   i,}
\DoxyCodeLine{00055                 \textcolor{keywordtype}{int}                   j);}
\DoxyCodeLine{00056 }
\DoxyCodeLine{00057 }
\DoxyCodeLine{00065 \textcolor{keywordtype}{int}}
\DoxyCodeLine{\Hypertarget{internal_8h_source_l00066}\mbox{\hyperlink{group__eval__loops__int_gaab3547bfcdc39d89babbc7ed2a1a4b65}{00066}} \mbox{\hyperlink{group__eval__loops__int_gaab3547bfcdc39d89babbc7ed2a1a4b65}{vrna\_eval\_int\_loop}}(\mbox{\hyperlink{group__fold__compound_structvrna__fc__s}{vrna\_fold\_compound\_t}} *fc,}
\DoxyCodeLine{00067                    \textcolor{keywordtype}{int}                  i,}
\DoxyCodeLine{00068                    \textcolor{keywordtype}{int}                  j,}
\DoxyCodeLine{00069                    \textcolor{keywordtype}{int}                  k,}
\DoxyCodeLine{00070                    \textcolor{keywordtype}{int}                  l);}
\DoxyCodeLine{00071 }
\DoxyCodeLine{00072 }
\DoxyCodeLine{00073 \textcolor{keywordtype}{int}}
\DoxyCodeLine{00074 vrna\_E\_ext\_int\_loop(\mbox{\hyperlink{group__fold__compound_structvrna__fc__s}{vrna\_fold\_compound\_t}}  *fc,}
\DoxyCodeLine{00075                     \textcolor{keywordtype}{int}                   i,}
\DoxyCodeLine{00076                     \textcolor{keywordtype}{int}                   j,}
\DoxyCodeLine{00077                     \textcolor{keywordtype}{int}                   *ip,}
\DoxyCodeLine{00078                     \textcolor{keywordtype}{int}                   *iq);}
\DoxyCodeLine{00079 }
\DoxyCodeLine{00080 }
\DoxyCodeLine{00081 \textcolor{keywordtype}{int}}
\DoxyCodeLine{00082 vrna\_E\_stack(\mbox{\hyperlink{group__fold__compound_structvrna__fc__s}{vrna\_fold\_compound\_t}} *fc,}
\DoxyCodeLine{00083              \textcolor{keywordtype}{int}                  i,}
\DoxyCodeLine{00084              \textcolor{keywordtype}{int}                  j);}
\DoxyCodeLine{00085 }
\DoxyCodeLine{00086 }
\DoxyCodeLine{00087 \textcolor{comment}{/* End basic interface */}}
\DoxyCodeLine{00097 \textcolor{comment}{/* j < i indicates circular folding, i.e. collect contributions for exterior int loops */}}
\DoxyCodeLine{00098 \mbox{\hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL}}}
\DoxyCodeLine{00099 vrna\_exp\_E\_int\_loop(\mbox{\hyperlink{group__fold__compound_structvrna__fc__s}{vrna\_fold\_compound\_t}}  *fc,}
\DoxyCodeLine{00100                     \textcolor{keywordtype}{int}                   i,}
\DoxyCodeLine{00101                     \textcolor{keywordtype}{int}                   j);}
\DoxyCodeLine{00102 }
\DoxyCodeLine{00103 }
\DoxyCodeLine{00104 \mbox{\hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL}}}
\DoxyCodeLine{00105 vrna\_exp\_E\_interior\_loop(\mbox{\hyperlink{group__fold__compound_structvrna__fc__s}{vrna\_fold\_compound\_t}} *fc,}
\DoxyCodeLine{00106                          \textcolor{keywordtype}{int}                  i,}
\DoxyCodeLine{00107                          \textcolor{keywordtype}{int}                  j,}
\DoxyCodeLine{00108                          \textcolor{keywordtype}{int}                  k,}
\DoxyCodeLine{00109                          \textcolor{keywordtype}{int}                  l);}
\DoxyCodeLine{00110 }
\DoxyCodeLine{00111 }
\DoxyCodeLine{00112 \textcolor{comment}{/* End partition function interface */}}
\DoxyCodeLine{00130 \textcolor{keywordtype}{int}}
\DoxyCodeLine{\Hypertarget{internal_8h_source_l00131}\mbox{\hyperlink{group__mfe__backtracking_ga28015cfbd0afc759b94ff58cc241cb13}{00131}} \mbox{\hyperlink{group__mfe__backtracking_ga28015cfbd0afc759b94ff58cc241cb13}{vrna\_BT\_stack}}(\mbox{\hyperlink{group__fold__compound_structvrna__fc__s}{vrna\_fold\_compound\_t}}  *fc,}
\DoxyCodeLine{00132               \textcolor{keywordtype}{int}                   *i,}
\DoxyCodeLine{00133               \textcolor{keywordtype}{int}                   *j,}
\DoxyCodeLine{00134               \textcolor{keywordtype}{int}                   *en,}
\DoxyCodeLine{00135               \mbox{\hyperlink{group__data__structures_structvrna__bp__stack__s}{vrna\_bp\_stack\_t}}       *bp\_stack,}
\DoxyCodeLine{00136               \textcolor{keywordtype}{int}                   *stack\_count);}
\DoxyCodeLine{00137 }
\DoxyCodeLine{00138 }
\DoxyCodeLine{00143 \textcolor{keywordtype}{int}}
\DoxyCodeLine{\Hypertarget{internal_8h_source_l00144}\mbox{\hyperlink{group__mfe__backtracking_ga90b5a5723173996fb40640ce7c95c07e}{00144}} \mbox{\hyperlink{group__mfe__backtracking_ga90b5a5723173996fb40640ce7c95c07e}{vrna\_BT\_int\_loop}}(\mbox{\hyperlink{group__fold__compound_structvrna__fc__s}{vrna\_fold\_compound\_t}} *fc,}
\DoxyCodeLine{00145                  \textcolor{keywordtype}{int}                  *i,}
\DoxyCodeLine{00146                  \textcolor{keywordtype}{int}                  *j,}
\DoxyCodeLine{00147                  \textcolor{keywordtype}{int}                  en,}
\DoxyCodeLine{00148                  \mbox{\hyperlink{group__data__structures_structvrna__bp__stack__s}{vrna\_bp\_stack\_t}}      *bp\_stack,}
\DoxyCodeLine{00149                  \textcolor{keywordtype}{int}                  *stack\_count);}
\DoxyCodeLine{00150 }
\DoxyCodeLine{00151 }
\DoxyCodeLine{00157 \textcolor{preprocessor}{\#ifndef VRNA\_DISABLE\_BACKWARD\_COMPATIBILITY}}
\DoxyCodeLine{00164 \textcolor{preprocessor}{\#ifdef ON\_SAME\_STRAND}}
\DoxyCodeLine{00165 \textcolor{preprocessor}{\#undef ON\_SAME\_STRAND}}
\DoxyCodeLine{00166 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00167 }
\DoxyCodeLine{00168 \textcolor{preprocessor}{\#define ON\_SAME\_STRAND(I, J, C)  (((I) >= (C)) || ((J) < (C)))}}
\DoxyCodeLine{00169 }
\DoxyCodeLine{00214 PRIVATE INLINE \textcolor{keywordtype}{int} \mbox{\hyperlink{group__eval__deprecated_gaafbc187b7f78e8e82afb77dd6f3b8fc5}{E\_IntLoop}}(\textcolor{keywordtype}{int}          n1,}
\DoxyCodeLine{00215                              \textcolor{keywordtype}{int}          n2,}
\DoxyCodeLine{00216                              \textcolor{keywordtype}{int}          type,}
\DoxyCodeLine{00217                              \textcolor{keywordtype}{int}          type\_2,}
\DoxyCodeLine{00218                              \textcolor{keywordtype}{int}          si1,}
\DoxyCodeLine{00219                              \textcolor{keywordtype}{int}          sj1,}
\DoxyCodeLine{00220                              \textcolor{keywordtype}{int}          sp1,}
\DoxyCodeLine{00221                              \textcolor{keywordtype}{int}          sq1,}
\DoxyCodeLine{00222                              \mbox{\hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t}} *P);}
\DoxyCodeLine{00223 }
\DoxyCodeLine{00224 }
\DoxyCodeLine{00244 PRIVATE INLINE \mbox{\hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL}} \mbox{\hyperlink{group__eval__deprecated_ga95de54d8a2a17645a95e0f34e189d9c9}{exp\_E\_IntLoop}}(\textcolor{keywordtype}{int}               u1,}
\DoxyCodeLine{00245                                         \textcolor{keywordtype}{int}               u2,}
\DoxyCodeLine{00246                                         \textcolor{keywordtype}{int}               type,}
\DoxyCodeLine{00247                                         \textcolor{keywordtype}{int}               type2,}
\DoxyCodeLine{00248                                         \textcolor{keywordtype}{short}             si1,}
\DoxyCodeLine{00249                                         \textcolor{keywordtype}{short}             sj1,}
\DoxyCodeLine{00250                                         \textcolor{keywordtype}{short}             sp1,}
\DoxyCodeLine{00251                                         \textcolor{keywordtype}{short}             sq1,}
\DoxyCodeLine{00252                                         \mbox{\hyperlink{group__energy__parameters_structvrna__exp__param__s}{vrna\_exp\_param\_t}}  *P);}
\DoxyCodeLine{00253 }
\DoxyCodeLine{00254 }
\DoxyCodeLine{00255 PRIVATE INLINE \textcolor{keywordtype}{int} E\_IntLoop\_Co(\textcolor{keywordtype}{int}           type,}
\DoxyCodeLine{00256                                 \textcolor{keywordtype}{int}           type\_2,}
\DoxyCodeLine{00257                                 \textcolor{keywordtype}{int}           i,}
\DoxyCodeLine{00258                                 \textcolor{keywordtype}{int}           j,}
\DoxyCodeLine{00259                                 \textcolor{keywordtype}{int}           p,}
\DoxyCodeLine{00260                                 \textcolor{keywordtype}{int}           q,}
\DoxyCodeLine{00261                                 \textcolor{keywordtype}{int}           cutpoint,}
\DoxyCodeLine{00262                                 \textcolor{keywordtype}{short}         si1,}
\DoxyCodeLine{00263                                 \textcolor{keywordtype}{short}         sj1,}
\DoxyCodeLine{00264                                 \textcolor{keywordtype}{short}         sp1,}
\DoxyCodeLine{00265                                 \textcolor{keywordtype}{short}         sq1,}
\DoxyCodeLine{00266                                 \textcolor{keywordtype}{int}           \mbox{\hyperlink{group__model__details_ga72b511ed1201f7e23ec437e468790d74}{dangles}},}
\DoxyCodeLine{00267                                 \mbox{\hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t}}  *P);}
\DoxyCodeLine{00268 }
\DoxyCodeLine{00269 }
\DoxyCodeLine{00270 \textcolor{comment}{/*}}
\DoxyCodeLine{00271 \textcolor{comment}{ *  ugly but fast interior loop evaluation}}
\DoxyCodeLine{00272 \textcolor{comment}{ *}}
\DoxyCodeLine{00273 \textcolor{comment}{ *  Avoid including this function in your own code. It only serves}}
\DoxyCodeLine{00274 \textcolor{comment}{ *  as a fast inline block internally re-\/used throughout the RNAlib. It}}
\DoxyCodeLine{00275 \textcolor{comment}{ *  evalutes the free energy of interior loops in single sequences or sequence}}
\DoxyCodeLine{00276 \textcolor{comment}{ *  hybrids. Soft constraints are also applied if available.}}
\DoxyCodeLine{00277 \textcolor{comment}{ *}}
\DoxyCodeLine{00278 \textcolor{comment}{ *  NOTE: do not include into doxygen reference manual!}}
\DoxyCodeLine{00279 \textcolor{comment}{ */}}
\DoxyCodeLine{00280 PRIVATE INLINE \textcolor{keywordtype}{int}}
\DoxyCodeLine{00281 ubf\_eval\_int\_loop(\textcolor{keywordtype}{int}           i,}
\DoxyCodeLine{00282                   \textcolor{keywordtype}{int}           j,}
\DoxyCodeLine{00283                   \textcolor{keywordtype}{int}           p,}
\DoxyCodeLine{00284                   \textcolor{keywordtype}{int}           q,}
\DoxyCodeLine{00285                   \textcolor{keywordtype}{int}           i1,}
\DoxyCodeLine{00286                   \textcolor{keywordtype}{int}           j1,}
\DoxyCodeLine{00287                   \textcolor{keywordtype}{int}           p1,}
\DoxyCodeLine{00288                   \textcolor{keywordtype}{int}           q1,}
\DoxyCodeLine{00289                   \textcolor{keywordtype}{short}         si,}
\DoxyCodeLine{00290                   \textcolor{keywordtype}{short}         sj,}
\DoxyCodeLine{00291                   \textcolor{keywordtype}{short}         sp,}
\DoxyCodeLine{00292                   \textcolor{keywordtype}{short}         sq,}
\DoxyCodeLine{00293                   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} type,}
\DoxyCodeLine{00294                   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} type\_2,}
\DoxyCodeLine{00295                   \textcolor{keywordtype}{int}           *rtype,}
\DoxyCodeLine{00296                   \textcolor{keywordtype}{int}           ij,}
\DoxyCodeLine{00297                   \textcolor{keywordtype}{int}           cp,}
\DoxyCodeLine{00298                   \mbox{\hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t}}  *P,}
\DoxyCodeLine{00299                   \mbox{\hyperlink{group__soft__constraints_structvrna__sc__s}{vrna\_sc\_t}}     *sc)}
\DoxyCodeLine{00300 \{}
\DoxyCodeLine{00301   \textcolor{keywordtype}{int} energy, u1, u2;}
\DoxyCodeLine{00302 }
\DoxyCodeLine{00303   u1  = p1 -\/ i;}
\DoxyCodeLine{00304   u2  = j1 -\/ q;}
\DoxyCodeLine{00305 }
\DoxyCodeLine{00306   \textcolor{keywordflow}{if} ((cp < 0) || (ON\_SAME\_STRAND(i, p, cp) \&\& ON\_SAME\_STRAND(q, j, cp))) \{}
\DoxyCodeLine{00307     \textcolor{comment}{/* regular interior loop */}}
\DoxyCodeLine{00308     energy = \mbox{\hyperlink{group__eval__deprecated_gaafbc187b7f78e8e82afb77dd6f3b8fc5}{E\_IntLoop}}(u1, u2, type, type\_2, si, sj, sp, sq, P);}
\DoxyCodeLine{00309   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00310     \textcolor{comment}{/* interior loop like cofold structure */}}
\DoxyCodeLine{00311     \textcolor{keywordtype}{short} Si, Sj;}
\DoxyCodeLine{00312     Si      = ON\_SAME\_STRAND(i, i1, cp) ? si : -\/1;}
\DoxyCodeLine{00313     Sj      = ON\_SAME\_STRAND(j1, j, cp) ? sj : -\/1;}
\DoxyCodeLine{00314     energy  = E\_IntLoop\_Co(rtype[type], rtype[type\_2],}
\DoxyCodeLine{00315                            i, j, p, q,}
\DoxyCodeLine{00316                            cp,}
\DoxyCodeLine{00317                            Si, Sj,}
\DoxyCodeLine{00318                            sp, sq,}
\DoxyCodeLine{00319                            P-\/>\mbox{\hyperlink{group__energy__parameters_a7b84353eb9075c595bad4ceb871bcae7}{model\_details}}.\mbox{\hyperlink{group__model__details_adcda4ff2ea77748ae0e8700288282efc}{dangles}},}
\DoxyCodeLine{00320                            P);}
\DoxyCodeLine{00321   \}}
\DoxyCodeLine{00322 }
\DoxyCodeLine{00323   \textcolor{comment}{/* add soft constraints */}}
\DoxyCodeLine{00324   \textcolor{keywordflow}{if} (sc) \{}
\DoxyCodeLine{00325     \textcolor{keywordflow}{if} (sc-\/>\mbox{\hyperlink{group__soft__constraints_a57e4dbb924ab11f304e3762a3a9b07a1}{energy\_up}})}
\DoxyCodeLine{00326       energy += sc-\/>\mbox{\hyperlink{group__soft__constraints_a57e4dbb924ab11f304e3762a3a9b07a1}{energy\_up}}[i1][u1]}
\DoxyCodeLine{00327                 + sc-\/>\mbox{\hyperlink{group__soft__constraints_a57e4dbb924ab11f304e3762a3a9b07a1}{energy\_up}}[q1][u2];}
\DoxyCodeLine{00328 }
\DoxyCodeLine{00329     \textcolor{keywordflow}{if} (sc-\/>\mbox{\hyperlink{group__soft__constraints_ad139b8e06632e00cbcf3909815d0d03d}{energy\_bp}})}
\DoxyCodeLine{00330       energy += sc-\/>\mbox{\hyperlink{group__soft__constraints_ad139b8e06632e00cbcf3909815d0d03d}{energy\_bp}}[ij];}
\DoxyCodeLine{00331 }
\DoxyCodeLine{00332     \textcolor{keywordflow}{if} (sc-\/>\mbox{\hyperlink{group__soft__constraints_ac20dded6068e81acd0f1139092f66a22}{energy\_stack}})}
\DoxyCodeLine{00333       \textcolor{keywordflow}{if} (u1 + u2 == 0) \{}
\DoxyCodeLine{00334         \textcolor{keywordtype}{int} a = sc-\/>\mbox{\hyperlink{group__soft__constraints_ac20dded6068e81acd0f1139092f66a22}{energy\_stack}}[i]}
\DoxyCodeLine{00335                 + sc-\/>\mbox{\hyperlink{group__soft__constraints_ac20dded6068e81acd0f1139092f66a22}{energy\_stack}}[p]}
\DoxyCodeLine{00336                 + sc-\/>\mbox{\hyperlink{group__soft__constraints_ac20dded6068e81acd0f1139092f66a22}{energy\_stack}}[q]}
\DoxyCodeLine{00337                 + sc-\/>\mbox{\hyperlink{group__soft__constraints_ac20dded6068e81acd0f1139092f66a22}{energy\_stack}}[j];}
\DoxyCodeLine{00338         energy += a;}
\DoxyCodeLine{00339       \}}
\DoxyCodeLine{00340 }
\DoxyCodeLine{00341     \textcolor{keywordflow}{if} (sc-\/>\mbox{\hyperlink{group__soft__constraints_a32dc86090237888c75491bbd4861a04b}{f}})}
\DoxyCodeLine{00342       energy += sc-\/>\mbox{\hyperlink{group__soft__constraints_a32dc86090237888c75491bbd4861a04b}{f}}(i, j, p, q, \mbox{\hyperlink{group__constraints_gaeab04f34d7730cff2d651d782f95d857}{VRNA\_DECOMP\_PAIR\_IL}}, sc-\/>\mbox{\hyperlink{group__soft__constraints_a7574680143df97b9029146c2150bf06d}{data}});}
\DoxyCodeLine{00343   \}}
\DoxyCodeLine{00344 }
\DoxyCodeLine{00345   \textcolor{keywordflow}{return} energy;}
\DoxyCodeLine{00346 \}}
\DoxyCodeLine{00347 }
\DoxyCodeLine{00348 }
\DoxyCodeLine{00349 PRIVATE INLINE \textcolor{keywordtype}{int}}
\DoxyCodeLine{00350 ubf\_eval\_int\_loop2(\textcolor{keywordtype}{int}            i,}
\DoxyCodeLine{00351                    \textcolor{keywordtype}{int}            j,}
\DoxyCodeLine{00352                    \textcolor{keywordtype}{int}            p,}
\DoxyCodeLine{00353                    \textcolor{keywordtype}{int}            q,}
\DoxyCodeLine{00354                    \textcolor{keywordtype}{int}            i1,}
\DoxyCodeLine{00355                    \textcolor{keywordtype}{int}            j1,}
\DoxyCodeLine{00356                    \textcolor{keywordtype}{int}            p1,}
\DoxyCodeLine{00357                    \textcolor{keywordtype}{int}            q1,}
\DoxyCodeLine{00358                    \textcolor{keywordtype}{short}          si,}
\DoxyCodeLine{00359                    \textcolor{keywordtype}{short}          sj,}
\DoxyCodeLine{00360                    \textcolor{keywordtype}{short}          sp,}
\DoxyCodeLine{00361                    \textcolor{keywordtype}{short}          sq,}
\DoxyCodeLine{00362                    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}  type,}
\DoxyCodeLine{00363                    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}  type\_2,}
\DoxyCodeLine{00364                    \textcolor{keywordtype}{int}            *rtype,}
\DoxyCodeLine{00365                    \textcolor{keywordtype}{int}            ij,}
\DoxyCodeLine{00366                    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}   *sn,}
\DoxyCodeLine{00367                    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}   *ss,}
\DoxyCodeLine{00368                    \mbox{\hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t}}   *P,}
\DoxyCodeLine{00369                    \mbox{\hyperlink{group__soft__constraints_structvrna__sc__s}{vrna\_sc\_t}}      *sc)}
\DoxyCodeLine{00370 \{}
\DoxyCodeLine{00371   \textcolor{keywordtype}{int} energy, u1, u2;}
\DoxyCodeLine{00372 }
\DoxyCodeLine{00373   u1  = p1 -\/ i;}
\DoxyCodeLine{00374   u2  = j1 -\/ q;}
\DoxyCodeLine{00375 }
\DoxyCodeLine{00376   \textcolor{keywordflow}{if} ((sn[i] == sn[p]) \&\& (sn[q] == sn[j])) \{}
\DoxyCodeLine{00377     \textcolor{comment}{/* regular interior loop */}}
\DoxyCodeLine{00378     energy = \mbox{\hyperlink{group__eval__deprecated_gaafbc187b7f78e8e82afb77dd6f3b8fc5}{E\_IntLoop}}(u1, u2, type, type\_2, si, sj, sp, sq, P);}
\DoxyCodeLine{00379   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00380     \textcolor{comment}{/* interior loop like cofold structure */}}
\DoxyCodeLine{00381     \textcolor{keywordtype}{short} Si, Sj;}
\DoxyCodeLine{00382     Si      = (sn[i1] == sn[i]) ? si : -\/1;}
\DoxyCodeLine{00383     Sj      = (sn[j] == sn[j1]) ? sj : -\/1;}
\DoxyCodeLine{00384     energy  = E\_IntLoop\_Co(rtype[type], rtype[type\_2],}
\DoxyCodeLine{00385                            i, j, p, q,}
\DoxyCodeLine{00386                            ss[1],}
\DoxyCodeLine{00387                            Si, Sj,}
\DoxyCodeLine{00388                            sp, sq,}
\DoxyCodeLine{00389                            P-\/>\mbox{\hyperlink{group__energy__parameters_a7b84353eb9075c595bad4ceb871bcae7}{model\_details}}.\mbox{\hyperlink{group__model__details_adcda4ff2ea77748ae0e8700288282efc}{dangles}},}
\DoxyCodeLine{00390                            P);}
\DoxyCodeLine{00391   \}}
\DoxyCodeLine{00392 }
\DoxyCodeLine{00393   \textcolor{comment}{/* add soft constraints */}}
\DoxyCodeLine{00394   \textcolor{keywordflow}{if} (sc) \{}
\DoxyCodeLine{00395     \textcolor{keywordflow}{if} (sc-\/>\mbox{\hyperlink{group__soft__constraints_a57e4dbb924ab11f304e3762a3a9b07a1}{energy\_up}})}
\DoxyCodeLine{00396       energy += sc-\/>\mbox{\hyperlink{group__soft__constraints_a57e4dbb924ab11f304e3762a3a9b07a1}{energy\_up}}[i1][u1]}
\DoxyCodeLine{00397                 + sc-\/>\mbox{\hyperlink{group__soft__constraints_a57e4dbb924ab11f304e3762a3a9b07a1}{energy\_up}}[q1][u2];}
\DoxyCodeLine{00398 }
\DoxyCodeLine{00399     \textcolor{keywordflow}{if} (sc-\/>\mbox{\hyperlink{group__soft__constraints_ad139b8e06632e00cbcf3909815d0d03d}{energy\_bp}})}
\DoxyCodeLine{00400       energy += sc-\/>\mbox{\hyperlink{group__soft__constraints_ad139b8e06632e00cbcf3909815d0d03d}{energy\_bp}}[ij];}
\DoxyCodeLine{00401 }
\DoxyCodeLine{00402     \textcolor{keywordflow}{if} (sc-\/>\mbox{\hyperlink{group__soft__constraints_ac20dded6068e81acd0f1139092f66a22}{energy\_stack}})}
\DoxyCodeLine{00403       \textcolor{keywordflow}{if} (u1 + u2 == 0) \{}
\DoxyCodeLine{00404         \textcolor{keywordtype}{int} a = sc-\/>\mbox{\hyperlink{group__soft__constraints_ac20dded6068e81acd0f1139092f66a22}{energy\_stack}}[i]}
\DoxyCodeLine{00405                 + sc-\/>\mbox{\hyperlink{group__soft__constraints_ac20dded6068e81acd0f1139092f66a22}{energy\_stack}}[p]}
\DoxyCodeLine{00406                 + sc-\/>\mbox{\hyperlink{group__soft__constraints_ac20dded6068e81acd0f1139092f66a22}{energy\_stack}}[q]}
\DoxyCodeLine{00407                 + sc-\/>\mbox{\hyperlink{group__soft__constraints_ac20dded6068e81acd0f1139092f66a22}{energy\_stack}}[j];}
\DoxyCodeLine{00408         energy += a;}
\DoxyCodeLine{00409       \}}
\DoxyCodeLine{00410 }
\DoxyCodeLine{00411     \textcolor{keywordflow}{if} (sc-\/>\mbox{\hyperlink{group__soft__constraints_a32dc86090237888c75491bbd4861a04b}{f}})}
\DoxyCodeLine{00412       energy += sc-\/>\mbox{\hyperlink{group__soft__constraints_a32dc86090237888c75491bbd4861a04b}{f}}(i, j, p, q, \mbox{\hyperlink{group__constraints_gaeab04f34d7730cff2d651d782f95d857}{VRNA\_DECOMP\_PAIR\_IL}}, sc-\/>\mbox{\hyperlink{group__soft__constraints_a7574680143df97b9029146c2150bf06d}{data}});}
\DoxyCodeLine{00413   \}}
\DoxyCodeLine{00414 }
\DoxyCodeLine{00415   \textcolor{keywordflow}{return} energy;}
\DoxyCodeLine{00416 \}}
\DoxyCodeLine{00417 }
\DoxyCodeLine{00418 }
\DoxyCodeLine{00419 \textcolor{comment}{/*}}
\DoxyCodeLine{00420 \textcolor{comment}{ *  ugly but fast exterior interior loop evaluation}}
\DoxyCodeLine{00421 \textcolor{comment}{ *}}
\DoxyCodeLine{00422 \textcolor{comment}{ *  Avoid including this function in your own code. It only serves}}
\DoxyCodeLine{00423 \textcolor{comment}{ *  as a fast inline block internally re-\/used throughout the RNAlib. It}}
\DoxyCodeLine{00424 \textcolor{comment}{ *  evalutes the free energy of interior loops in single sequences or sequence}}
\DoxyCodeLine{00425 \textcolor{comment}{ *  hybrids. Soft constraints are also applied if available.}}
\DoxyCodeLine{00426 \textcolor{comment}{ *}}
\DoxyCodeLine{00427 \textcolor{comment}{ *  NOTE: do not include into doxygen reference manual!}}
\DoxyCodeLine{00428 \textcolor{comment}{ */}}
\DoxyCodeLine{00429 PRIVATE INLINE \textcolor{keywordtype}{int}}
\DoxyCodeLine{00430 ubf\_eval\_ext\_int\_loop(\textcolor{keywordtype}{int}           i,}
\DoxyCodeLine{00431                       \textcolor{keywordtype}{int}           j,}
\DoxyCodeLine{00432                       \textcolor{keywordtype}{int}           p,}
\DoxyCodeLine{00433                       \textcolor{keywordtype}{int}           q,}
\DoxyCodeLine{00434                       \textcolor{keywordtype}{int}           i1,}
\DoxyCodeLine{00435                       \textcolor{keywordtype}{int}           j1,}
\DoxyCodeLine{00436                       \textcolor{keywordtype}{int}           p1,}
\DoxyCodeLine{00437                       \textcolor{keywordtype}{int}           q1,}
\DoxyCodeLine{00438                       \textcolor{keywordtype}{short}         si,}
\DoxyCodeLine{00439                       \textcolor{keywordtype}{short}         sj,}
\DoxyCodeLine{00440                       \textcolor{keywordtype}{short}         sp,}
\DoxyCodeLine{00441                       \textcolor{keywordtype}{short}         sq,}
\DoxyCodeLine{00442                       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} type,}
\DoxyCodeLine{00443                       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} type\_2,}
\DoxyCodeLine{00444                       \textcolor{keywordtype}{int}           length,}
\DoxyCodeLine{00445                       \mbox{\hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t}}  *P,}
\DoxyCodeLine{00446                       \mbox{\hyperlink{group__soft__constraints_structvrna__sc__s}{vrna\_sc\_t}}     *sc)}
\DoxyCodeLine{00447 \{}
\DoxyCodeLine{00448   \textcolor{keywordtype}{int} energy, u1, u2, u3;}
\DoxyCodeLine{00449 }
\DoxyCodeLine{00450   u1  = i1;}
\DoxyCodeLine{00451   u2  = p1 -\/ j;}
\DoxyCodeLine{00452   u3  = length -\/ q;}
\DoxyCodeLine{00453 }
\DoxyCodeLine{00454   energy = \mbox{\hyperlink{group__eval__deprecated_gaafbc187b7f78e8e82afb77dd6f3b8fc5}{E\_IntLoop}}(u2, u1 + u3, type, type\_2, si, sj, sp, sq, P);}
\DoxyCodeLine{00455 }
\DoxyCodeLine{00456   \textcolor{comment}{/* add soft constraints */}}
\DoxyCodeLine{00457   \textcolor{keywordflow}{if} (sc) \{}
\DoxyCodeLine{00458     \textcolor{keywordflow}{if} (sc-\/>\mbox{\hyperlink{group__soft__constraints_a57e4dbb924ab11f304e3762a3a9b07a1}{energy\_up}}) \{}
\DoxyCodeLine{00459       energy += sc-\/>\mbox{\hyperlink{group__soft__constraints_a57e4dbb924ab11f304e3762a3a9b07a1}{energy\_up}}[j1][u2]}
\DoxyCodeLine{00460                 + ((u3 > 0) ? sc-\/>\mbox{\hyperlink{group__soft__constraints_a57e4dbb924ab11f304e3762a3a9b07a1}{energy\_up}}[q1][u3] : 0)}
\DoxyCodeLine{00461                 + ((u1 > 0) ? sc-\/>\mbox{\hyperlink{group__soft__constraints_a57e4dbb924ab11f304e3762a3a9b07a1}{energy\_up}}[1][u1] : 0);}
\DoxyCodeLine{00462     \}}
\DoxyCodeLine{00463 }
\DoxyCodeLine{00464     \textcolor{keywordflow}{if} (sc-\/>\mbox{\hyperlink{group__soft__constraints_ac20dded6068e81acd0f1139092f66a22}{energy\_stack}})}
\DoxyCodeLine{00465       \textcolor{keywordflow}{if} (u1 + u2 + u3 == 0)}
\DoxyCodeLine{00466         energy += sc-\/>\mbox{\hyperlink{group__soft__constraints_ac20dded6068e81acd0f1139092f66a22}{energy\_stack}}[i]}
\DoxyCodeLine{00467                   + sc-\/>\mbox{\hyperlink{group__soft__constraints_ac20dded6068e81acd0f1139092f66a22}{energy\_stack}}[p]}
\DoxyCodeLine{00468                   + sc-\/>\mbox{\hyperlink{group__soft__constraints_ac20dded6068e81acd0f1139092f66a22}{energy\_stack}}[q]}
\DoxyCodeLine{00469                   + sc-\/>\mbox{\hyperlink{group__soft__constraints_ac20dded6068e81acd0f1139092f66a22}{energy\_stack}}[j];}
\DoxyCodeLine{00470 }
\DoxyCodeLine{00471     \textcolor{keywordflow}{if} (sc-\/>\mbox{\hyperlink{group__soft__constraints_a32dc86090237888c75491bbd4861a04b}{f}})}
\DoxyCodeLine{00472       energy += sc-\/>\mbox{\hyperlink{group__soft__constraints_a32dc86090237888c75491bbd4861a04b}{f}}(i, j, p, q, \mbox{\hyperlink{group__constraints_gaeab04f34d7730cff2d651d782f95d857}{VRNA\_DECOMP\_PAIR\_IL}}, sc-\/>\mbox{\hyperlink{group__soft__constraints_a7574680143df97b9029146c2150bf06d}{data}});}
\DoxyCodeLine{00473   \}}
\DoxyCodeLine{00474 }
\DoxyCodeLine{00475   \textcolor{keywordflow}{return} energy;}
\DoxyCodeLine{00476 \}}
\DoxyCodeLine{00477 }
\DoxyCodeLine{00478 }
\DoxyCodeLine{00479 PRIVATE INLINE \textcolor{keywordtype}{int}}
\DoxyCodeLine{\Hypertarget{internal_8h_source_l00480}\mbox{\hyperlink{group__eval__deprecated_gaafbc187b7f78e8e82afb77dd6f3b8fc5}{00480}} \mbox{\hyperlink{group__eval__deprecated_gaafbc187b7f78e8e82afb77dd6f3b8fc5}{E\_IntLoop}}(\textcolor{keywordtype}{int}           n1,}
\DoxyCodeLine{00481           \textcolor{keywordtype}{int}           n2,}
\DoxyCodeLine{00482           \textcolor{keywordtype}{int}           type,}
\DoxyCodeLine{00483           \textcolor{keywordtype}{int}           type\_2,}
\DoxyCodeLine{00484           \textcolor{keywordtype}{int}           si1,}
\DoxyCodeLine{00485           \textcolor{keywordtype}{int}           sj1,}
\DoxyCodeLine{00486           \textcolor{keywordtype}{int}           sp1,}
\DoxyCodeLine{00487           \textcolor{keywordtype}{int}           sq1,}
\DoxyCodeLine{00488           \mbox{\hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t}}  *P)}
\DoxyCodeLine{00489 \{}
\DoxyCodeLine{00490   \textcolor{comment}{/* compute energy of degree 2 loop (stack bulge or interior) */}}
\DoxyCodeLine{00491   \textcolor{keywordtype}{int} nl, ns, u, energy;}
\DoxyCodeLine{00492 }
\DoxyCodeLine{00493   \textcolor{keywordflow}{if} (n1 > n2) \{}
\DoxyCodeLine{00494     nl  = n1;}
\DoxyCodeLine{00495     ns  = n2;}
\DoxyCodeLine{00496   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00497     nl  = n2;}
\DoxyCodeLine{00498     ns  = n1;}
\DoxyCodeLine{00499   \}}
\DoxyCodeLine{00500 }
\DoxyCodeLine{00501   \textcolor{keywordflow}{if} (nl == 0)}
\DoxyCodeLine{00502     \textcolor{keywordflow}{return} P-\/>stack[type][type\_2];  \textcolor{comment}{/* stack */}}
\DoxyCodeLine{00503 }
\DoxyCodeLine{00504   \textcolor{keywordflow}{if} (ns == 0) \{}
\DoxyCodeLine{00505     \textcolor{comment}{/* bulge */}}
\DoxyCodeLine{00506     energy = (nl <= \mbox{\hyperlink{constants_8h_ad1bd6eabac419670ddd3c9ed82145988}{MAXLOOP}}) ? P-\/>bulge[nl] :}
\DoxyCodeLine{00507              (P-\/>bulge[30] + (\textcolor{keywordtype}{int})(P-\/>lxc * log(nl / 30.)));}
\DoxyCodeLine{00508     \textcolor{keywordflow}{if} (nl == 1) \{}
\DoxyCodeLine{00509       energy += P-\/>stack[type][type\_2];}
\DoxyCodeLine{00510     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00511       \textcolor{keywordflow}{if} (type > 2)}
\DoxyCodeLine{00512         energy += P-\/>TerminalAU;}
\DoxyCodeLine{00513 }
\DoxyCodeLine{00514       \textcolor{keywordflow}{if} (type\_2 > 2)}
\DoxyCodeLine{00515         energy += P-\/>TerminalAU;}
\DoxyCodeLine{00516     \}}
\DoxyCodeLine{00517 }
\DoxyCodeLine{00518     \textcolor{keywordflow}{return} energy;}
\DoxyCodeLine{00519   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00520     \textcolor{comment}{/* interior loop */}}
\DoxyCodeLine{00521     \textcolor{keywordflow}{if} (ns == 1) \{}
\DoxyCodeLine{00522       \textcolor{keywordflow}{if} (nl == 1)                    \textcolor{comment}{/* 1x1 loop */}}
\DoxyCodeLine{00523         \textcolor{keywordflow}{return} P-\/>int11[type][type\_2][si1][sj1];}
\DoxyCodeLine{00524 }
\DoxyCodeLine{00525       \textcolor{keywordflow}{if} (nl == 2) \{}
\DoxyCodeLine{00526         \textcolor{comment}{/* 2x1 loop */}}
\DoxyCodeLine{00527         \textcolor{keywordflow}{if} (n1 == 1)}
\DoxyCodeLine{00528           energy = P-\/>int21[type][type\_2][si1][sq1][sj1];}
\DoxyCodeLine{00529         \textcolor{keywordflow}{else}}
\DoxyCodeLine{00530           energy = P-\/>int21[type\_2][type][sq1][si1][sp1];}
\DoxyCodeLine{00531 }
\DoxyCodeLine{00532         \textcolor{keywordflow}{return} energy;}
\DoxyCodeLine{00533       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00534         \textcolor{comment}{/* 1xn loop */}}
\DoxyCodeLine{00535         energy =}
\DoxyCodeLine{00536           (nl + 1 <=}
\DoxyCodeLine{00537            \mbox{\hyperlink{constants_8h_ad1bd6eabac419670ddd3c9ed82145988}{MAXLOOP}}) ? (P-\/>internal\_loop[nl + 1]) : (P-\/>internal\_loop[30] +}
\DoxyCodeLine{00538                                                     (int)(P-\/>lxc * log((nl + 1) / 30.)));}
\DoxyCodeLine{00539         energy  += \mbox{\hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}}(MAX\_NINIO, (nl -\/ ns) * P-\/>ninio[2]);}
\DoxyCodeLine{00540         energy  += P-\/>mismatch1nI[type][si1][sj1] + P-\/>mismatch1nI[type\_2][sq1][sp1];}
\DoxyCodeLine{00541         \textcolor{keywordflow}{return} energy;}
\DoxyCodeLine{00542       \}}
\DoxyCodeLine{00543     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ns == 2) \{}
\DoxyCodeLine{00544       \textcolor{keywordflow}{if} (nl == 2) \{}
\DoxyCodeLine{00545         \textcolor{comment}{/* 2x2 loop */}}
\DoxyCodeLine{00546         \textcolor{keywordflow}{return} P-\/>int22[type][type\_2][si1][sp1][sq1][sj1];}
\DoxyCodeLine{00547       \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (nl == 3) \{}
\DoxyCodeLine{00548         \textcolor{comment}{/* 2x3 loop */}}
\DoxyCodeLine{00549         energy  = P-\/>internal\_loop[5] + P-\/>ninio[2];}
\DoxyCodeLine{00550         energy  += P-\/>mismatch23I[type][si1][sj1] + P-\/>mismatch23I[type\_2][sq1][sp1];}
\DoxyCodeLine{00551         \textcolor{keywordflow}{return} energy;}
\DoxyCodeLine{00552       \}}
\DoxyCodeLine{00553     \}}
\DoxyCodeLine{00554 }
\DoxyCodeLine{00555     \{}
\DoxyCodeLine{00556       \textcolor{comment}{/* generic interior loop (no else here!)*/}}
\DoxyCodeLine{00557       u       = nl + ns;}
\DoxyCodeLine{00558       energy  =}
\DoxyCodeLine{00559         (u <=}
\DoxyCodeLine{00560          \mbox{\hyperlink{constants_8h_ad1bd6eabac419670ddd3c9ed82145988}{MAXLOOP}}) ? (P-\/>internal\_loop[u]) : (P-\/>internal\_loop[30] + (int)(P-\/>lxc * log((u) / 30.)));}
\DoxyCodeLine{00561 }
\DoxyCodeLine{00562       energy += \mbox{\hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}}(MAX\_NINIO, (nl -\/ ns) * P-\/>ninio[2]);}
\DoxyCodeLine{00563 }
\DoxyCodeLine{00564       energy += P-\/>mismatchI[type][si1][sj1] + P-\/>mismatchI[type\_2][sq1][sp1];}
\DoxyCodeLine{00565     \}}
\DoxyCodeLine{00566   \}}
\DoxyCodeLine{00567 }
\DoxyCodeLine{00568   \textcolor{keywordflow}{return} energy;}
\DoxyCodeLine{00569 \}}
\DoxyCodeLine{00570 }
\DoxyCodeLine{00571 }
\DoxyCodeLine{00572 PRIVATE INLINE \mbox{\hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL}}}
\DoxyCodeLine{\Hypertarget{internal_8h_source_l00573}\mbox{\hyperlink{group__eval__deprecated_ga95de54d8a2a17645a95e0f34e189d9c9}{00573}} \mbox{\hyperlink{group__eval__deprecated_ga95de54d8a2a17645a95e0f34e189d9c9}{exp\_E\_IntLoop}}(\textcolor{keywordtype}{int}               u1,}
\DoxyCodeLine{00574               \textcolor{keywordtype}{int}               u2,}
\DoxyCodeLine{00575               \textcolor{keywordtype}{int}               type,}
\DoxyCodeLine{00576               \textcolor{keywordtype}{int}               type2,}
\DoxyCodeLine{00577               \textcolor{keywordtype}{short}             si1,}
\DoxyCodeLine{00578               \textcolor{keywordtype}{short}             sj1,}
\DoxyCodeLine{00579               \textcolor{keywordtype}{short}             sp1,}
\DoxyCodeLine{00580               \textcolor{keywordtype}{short}             sq1,}
\DoxyCodeLine{00581               \mbox{\hyperlink{group__energy__parameters_structvrna__exp__param__s}{vrna\_exp\_param\_t}}  *P)}
\DoxyCodeLine{00582 \{}
\DoxyCodeLine{00583   \textcolor{keywordtype}{int}     ul, us, no\_close = 0;}
\DoxyCodeLine{00584   \textcolor{keywordtype}{double}  z           = 0.;}
\DoxyCodeLine{00585   \textcolor{keywordtype}{int}     noGUclosure = P-\/>\mbox{\hyperlink{group__energy__parameters_ac18055127bccc27c1223f1d2f3b01b53}{model\_details}}.\mbox{\hyperlink{group__model__details_a7e883db1f33f8f3baa5c9b140350c78e}{noGUclosure}};}
\DoxyCodeLine{00586 }
\DoxyCodeLine{00587   \textcolor{keywordflow}{if} ((noGUclosure) \&\& ((type2 == 3) || (type2 == 4) || (type == 3) || (type == 4)))}
\DoxyCodeLine{00588     no\_close = 1;}
\DoxyCodeLine{00589 }
\DoxyCodeLine{00590   \textcolor{keywordflow}{if} (u1 > u2) \{}
\DoxyCodeLine{00591     ul  = u1;}
\DoxyCodeLine{00592     us  = u2;}
\DoxyCodeLine{00593   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00594     ul  = u2;}
\DoxyCodeLine{00595     us  = u1;}
\DoxyCodeLine{00596   \}}
\DoxyCodeLine{00597 }
\DoxyCodeLine{00598   \textcolor{keywordflow}{if} (ul == 0) \{}
\DoxyCodeLine{00599     \textcolor{comment}{/* stack */}}
\DoxyCodeLine{00600     z = P-\/>expstack[type][type2];}
\DoxyCodeLine{00601   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!no\_close) \{}
\DoxyCodeLine{00602     \textcolor{keywordflow}{if} (us == 0) \{}
\DoxyCodeLine{00603       \textcolor{comment}{/* bulge */}}
\DoxyCodeLine{00604       z = P-\/>expbulge[ul];}
\DoxyCodeLine{00605       \textcolor{keywordflow}{if} (ul == 1) \{}
\DoxyCodeLine{00606         z *= P-\/>expstack[type][type2];}
\DoxyCodeLine{00607       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00608         \textcolor{keywordflow}{if} (type > 2)}
\DoxyCodeLine{00609           z *= P-\/>expTermAU;}
\DoxyCodeLine{00610 }
\DoxyCodeLine{00611         \textcolor{keywordflow}{if} (type2 > 2)}
\DoxyCodeLine{00612           z *= P-\/>expTermAU;}
\DoxyCodeLine{00613       \}}
\DoxyCodeLine{00614 }
\DoxyCodeLine{00615       \textcolor{keywordflow}{return} (\mbox{\hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL}})z;}
\DoxyCodeLine{00616     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (us == 1) \{}
\DoxyCodeLine{00617       \textcolor{keywordflow}{if} (ul == 1)                     \textcolor{comment}{/* 1x1 loop */}}
\DoxyCodeLine{00618         \textcolor{keywordflow}{return} (\mbox{\hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL}})(P-\/>expint11[type][type2][si1][sj1]);}
\DoxyCodeLine{00619 }
\DoxyCodeLine{00620       \textcolor{keywordflow}{if} (ul == 2) \{}
\DoxyCodeLine{00621         \textcolor{comment}{/* 2x1 loop */}}
\DoxyCodeLine{00622         \textcolor{keywordflow}{if} (u1 == 1)}
\DoxyCodeLine{00623           \textcolor{keywordflow}{return} (\mbox{\hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL}})(P-\/>expint21[type][type2][si1][sq1][sj1]);}
\DoxyCodeLine{00624         \textcolor{keywordflow}{else}}
\DoxyCodeLine{00625           \textcolor{keywordflow}{return} (\mbox{\hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL}})(P-\/>expint21[type2][type][sq1][si1][sp1]);}
\DoxyCodeLine{00626       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00627         \textcolor{comment}{/* 1xn loop */}}
\DoxyCodeLine{00628         z = P-\/>expinternal[ul + us] * P-\/>expmismatch1nI[type][si1][sj1] *}
\DoxyCodeLine{00629             P-\/>expmismatch1nI[type2][sq1][sp1];}
\DoxyCodeLine{00630         \textcolor{keywordflow}{return} (\mbox{\hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL}})(z * P-\/>expninio[2][ul -\/ us]);}
\DoxyCodeLine{00631       \}}
\DoxyCodeLine{00632     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (us == 2) \{}
\DoxyCodeLine{00633       \textcolor{keywordflow}{if} (ul == 2) \{}
\DoxyCodeLine{00634         \textcolor{comment}{/* 2x2 loop */}}
\DoxyCodeLine{00635         \textcolor{keywordflow}{return} (\mbox{\hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL}})(P-\/>expint22[type][type2][si1][sp1][sq1][sj1]);}
\DoxyCodeLine{00636       \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ul == 3) \{}
\DoxyCodeLine{00637         \textcolor{comment}{/* 2x3 loop */}}
\DoxyCodeLine{00638         z = P-\/>expinternal[5] * P-\/>expmismatch23I[type][si1][sj1] *}
\DoxyCodeLine{00639             P-\/>expmismatch23I[type2][sq1][sp1];}
\DoxyCodeLine{00640         \textcolor{keywordflow}{return} (\mbox{\hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL}})(z * P-\/>expninio[2][1]);}
\DoxyCodeLine{00641       \}}
\DoxyCodeLine{00642     \}}
\DoxyCodeLine{00643 }
\DoxyCodeLine{00644     \textcolor{comment}{/* generic interior loop (no else here!)*/}}
\DoxyCodeLine{00645     z = P-\/>expinternal[ul + us] * P-\/>expmismatchI[type][si1][sj1] *}
\DoxyCodeLine{00646         P-\/>expmismatchI[type2][sq1][sp1];}
\DoxyCodeLine{00647     \textcolor{keywordflow}{return} (\mbox{\hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL}})(z * P-\/>expninio[2][ul -\/ us]);}
\DoxyCodeLine{00648   \}}
\DoxyCodeLine{00649 }
\DoxyCodeLine{00650   \textcolor{keywordflow}{return} (\mbox{\hyperlink{group__data__structures_ga31125aeace516926bf7f251f759b6126}{FLT\_OR\_DBL}})z;}
\DoxyCodeLine{00651 \}}
\DoxyCodeLine{00652 }
\DoxyCodeLine{00653 }
\DoxyCodeLine{00654 PRIVATE INLINE \textcolor{keywordtype}{int}}
\DoxyCodeLine{00655 E\_IntLoop\_Co(\textcolor{keywordtype}{int}          type,}
\DoxyCodeLine{00656              \textcolor{keywordtype}{int}          type\_2,}
\DoxyCodeLine{00657              \textcolor{keywordtype}{int}          i,}
\DoxyCodeLine{00658              \textcolor{keywordtype}{int}          j,}
\DoxyCodeLine{00659              \textcolor{keywordtype}{int}          p,}
\DoxyCodeLine{00660              \textcolor{keywordtype}{int}          q,}
\DoxyCodeLine{00661              \textcolor{keywordtype}{int}          cutpoint,}
\DoxyCodeLine{00662              \textcolor{keywordtype}{short}        si1,}
\DoxyCodeLine{00663              \textcolor{keywordtype}{short}        sj1,}
\DoxyCodeLine{00664              \textcolor{keywordtype}{short}        sp1,}
\DoxyCodeLine{00665              \textcolor{keywordtype}{short}        sq1,}
\DoxyCodeLine{00666              \textcolor{keywordtype}{int}          \mbox{\hyperlink{group__model__details_ga72b511ed1201f7e23ec437e468790d74}{dangles}},}
\DoxyCodeLine{00667              \mbox{\hyperlink{group__energy__parameters_structvrna__param__s}{vrna\_param\_t}} *P)}
\DoxyCodeLine{00668 \{}
\DoxyCodeLine{00669   \textcolor{keywordtype}{int} e, energy, ci, cj, cp, cq, d3, d5, d5\_2, d3\_2, tmm, tmm\_2;}
\DoxyCodeLine{00670 }
\DoxyCodeLine{00671   energy = 0;}
\DoxyCodeLine{00672   \textcolor{keywordflow}{if} (type > 2)}
\DoxyCodeLine{00673     energy += P-\/>TerminalAU;}
\DoxyCodeLine{00674 }
\DoxyCodeLine{00675   \textcolor{keywordflow}{if} (type\_2 > 2)}
\DoxyCodeLine{00676     energy += P-\/>TerminalAU;}
\DoxyCodeLine{00677 }
\DoxyCodeLine{00678   \textcolor{keywordflow}{if} (!\mbox{\hyperlink{group__model__details_ga72b511ed1201f7e23ec437e468790d74}{dangles}})}
\DoxyCodeLine{00679     \textcolor{keywordflow}{return} energy;}
\DoxyCodeLine{00680 }
\DoxyCodeLine{00681   ci  = ON\_SAME\_STRAND(i, i + 1, cutpoint);}
\DoxyCodeLine{00682   cj  = ON\_SAME\_STRAND(j -\/ 1, j, cutpoint);}
\DoxyCodeLine{00683   cp  = ON\_SAME\_STRAND(p -\/ 1, p, cutpoint);}
\DoxyCodeLine{00684   cq  = ON\_SAME\_STRAND(q, q + 1, cutpoint);}
\DoxyCodeLine{00685 }
\DoxyCodeLine{00686   d3    = ci  ? P-\/>dangle3[type][si1]   : 0;}
\DoxyCodeLine{00687   d5    = cj  ? P-\/>dangle5[type][sj1]   : 0;}
\DoxyCodeLine{00688   d5\_2  = cp  ? P-\/>dangle5[type\_2][sp1] : 0;}
\DoxyCodeLine{00689   d3\_2  = cq  ? P-\/>dangle3[type\_2][sq1] : 0;}
\DoxyCodeLine{00690 }
\DoxyCodeLine{00691   tmm   = (cj \&\& ci) ? P-\/>mismatchExt[type][sj1][si1]   : d5 + d3;}
\DoxyCodeLine{00692   tmm\_2 = (cp \&\& cq) ? P-\/>mismatchExt[type\_2][sp1][sq1] : d5\_2 + d3\_2;}
\DoxyCodeLine{00693 }
\DoxyCodeLine{00694   \textcolor{keywordflow}{if} (\mbox{\hyperlink{group__model__details_ga72b511ed1201f7e23ec437e468790d74}{dangles}} == 2)}
\DoxyCodeLine{00695     \textcolor{keywordflow}{return} energy + tmm + tmm\_2;}
\DoxyCodeLine{00696 }
\DoxyCodeLine{00697   \textcolor{comment}{/* now we may have non-\/double dangles only */}}
\DoxyCodeLine{00698   \textcolor{keywordflow}{if} (p -\/ i > 2) \{}
\DoxyCodeLine{00699     \textcolor{keywordflow}{if} (j -\/ q > 2) \{}
\DoxyCodeLine{00700       \textcolor{comment}{/* all degrees of freedom */}}
\DoxyCodeLine{00701       e = \mbox{\hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}}(tmm, d5);}
\DoxyCodeLine{00702       e = \mbox{\hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}}(e, d3);}
\DoxyCodeLine{00703       energy += e;}
\DoxyCodeLine{00704       e = \mbox{\hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}}(tmm\_2, d5\_2);}
\DoxyCodeLine{00705       e = \mbox{\hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}}(e, d3\_2);}
\DoxyCodeLine{00706       energy += e;}
\DoxyCodeLine{00707     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (j -\/ q == 2) \{}
\DoxyCodeLine{00708       \textcolor{comment}{/* all degrees of freedom in 5' part between i and p */}}
\DoxyCodeLine{00709       e = \mbox{\hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}}(tmm + d5\_2, d3 + d5\_2);}
\DoxyCodeLine{00710       e = \mbox{\hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}}(e, d5 + d5\_2);}
\DoxyCodeLine{00711       e = \mbox{\hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}}(e, d3 + tmm\_2);}
\DoxyCodeLine{00712       e = \mbox{\hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}}(e, d3 + d3\_2);}
\DoxyCodeLine{00713       e = \mbox{\hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}}(e, tmm\_2); \textcolor{comment}{/* no dangles on enclosing pair */}}
\DoxyCodeLine{00714       e = \mbox{\hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}}(e, d5\_2);  \textcolor{comment}{/* no dangles on enclosing pair */}}
\DoxyCodeLine{00715       e = \mbox{\hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}}(e, d3\_2);  \textcolor{comment}{/* no dangles on enclosing pair */}}
\DoxyCodeLine{00716       energy += e;}
\DoxyCodeLine{00717     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00718       \textcolor{comment}{/* no unpaired base between q and j */}}
\DoxyCodeLine{00719       energy += d3 + d5\_2;}
\DoxyCodeLine{00720     \}}
\DoxyCodeLine{00721   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (p -\/ i == 2) \{}
\DoxyCodeLine{00722     \textcolor{keywordflow}{if} (j -\/ q > 2) \{}
\DoxyCodeLine{00723       \textcolor{comment}{/* all degrees of freedom in 3' part between q and j */}}
\DoxyCodeLine{00724       e = \mbox{\hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}}(tmm + d3\_2, d5 + d3\_2);}
\DoxyCodeLine{00725       e = \mbox{\hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}}(e, d5 + d3\_2);}
\DoxyCodeLine{00726       e = \mbox{\hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}}(e, d3 + d3\_2);}
\DoxyCodeLine{00727       e = \mbox{\hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}}(e, d5 + tmm\_2);}
\DoxyCodeLine{00728       e = \mbox{\hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}}(e, tmm\_2);}
\DoxyCodeLine{00729       e = \mbox{\hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}}(e, d5\_2);}
\DoxyCodeLine{00730       e = \mbox{\hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}}(e, d3\_2);}
\DoxyCodeLine{00731       energy += e;}
\DoxyCodeLine{00732     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (j -\/ q == 2) \{}
\DoxyCodeLine{00733       \textcolor{comment}{/* one possible dangling base between either side */}}
\DoxyCodeLine{00734       e = \mbox{\hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}}(tmm, tmm\_2);}
\DoxyCodeLine{00735       e = \mbox{\hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}}(e, d3);}
\DoxyCodeLine{00736       e = \mbox{\hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}}(e, d5);}
\DoxyCodeLine{00737       e = \mbox{\hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}}(e, d5\_2);}
\DoxyCodeLine{00738       e = \mbox{\hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}}(e, d3\_2);}
\DoxyCodeLine{00739       e = \mbox{\hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}}(e, d3 + d3\_2);}
\DoxyCodeLine{00740       e = \mbox{\hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}}(e, d5 + d5\_2);}
\DoxyCodeLine{00741       energy += e;}
\DoxyCodeLine{00742     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00743       \textcolor{comment}{/* one unpaired base between i and p */}}
\DoxyCodeLine{00744       energy += \mbox{\hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}}(d3, d5\_2);}
\DoxyCodeLine{00745     \}}
\DoxyCodeLine{00746   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00747     \textcolor{comment}{/* no unpaired base between i and p */}}
\DoxyCodeLine{00748     \textcolor{keywordflow}{if} (j -\/ q > 2) \{}
\DoxyCodeLine{00749       \textcolor{comment}{/* all degrees of freedom in 3' part between q and j */}}
\DoxyCodeLine{00750       energy += d5 + d3\_2;}
\DoxyCodeLine{00751     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (j -\/ q == 2) \{}
\DoxyCodeLine{00752       \textcolor{comment}{/* one unpaired base between q and j */}}
\DoxyCodeLine{00753       energy += \mbox{\hyperlink{group__utils_gae0b9cd0ce090bd69b951aa73e8fa4f7d}{MIN2}}(d5, d3\_2);}
\DoxyCodeLine{00754     \}}
\DoxyCodeLine{00755   \}}
\DoxyCodeLine{00756 }
\DoxyCodeLine{00757   \textcolor{keywordflow}{return} energy;}
\DoxyCodeLine{00758 \}}
\DoxyCodeLine{00759 }
\DoxyCodeLine{00760 }
\DoxyCodeLine{00765 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00766 }
\DoxyCodeLine{00767 \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
